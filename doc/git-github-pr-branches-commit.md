#Работа с Git/GitHub, оформление pull request, создание новых branches
Чтобы получить доступ к репозиторию проекта на отправку pull request - необходимо написать тимлиду свой логин на GitHub.

Есть два способа работы с проектом - Fork и клонирование с оригинального репозитория.
Предпочтительнее использовать второй способ:

1. Клонируем репозитарий с GitHub - https://github.com/WebEducationPlatform/CRM

2. Checkout на ветку **dev** в IDEA.

3. Создаем свою ветку и переключаемся на нее (см. **Правила именования веток** ниже).

4. Выполняем задачу.
Делаем коммиты в процессе решения (см. **Оформление коммита** ниже).
Не забываем при коммите снимать галочку с файлов, которые не нужны для выполнения задачи. Будьте внимательны!
Обязательно заполняем комментарии, чтобы другим было понятно, над чем вы работали.
Когда все готово: VCS -> Git -> Create pull request, заполняем заголовок request-а (см. **Оформление pull request** ниже).

## Правила именования веток

На каждое ваше задание заводится карточка в Trello (для получения доступа - необходимо отправить свой email тимлиду).
Если карточки с заданием нет - необходимо завести ее в Trello самостоятельно.

Новая ветка (branch) создается на основе ветки dev.
В зависимости от поставленной задачи, необходимо выбрать префикс для своей ветки:
для новых фич - feature, для исправления багов - bugfix, для тестов - test.

**Имя ветки состоит из нескольких частей, разделенных слэш "/"**
* префикс/id-карточки-с-заданием-из-Trello/имя-описывающее-кратко-суть-задания

Например: **feature/869/PR-regulations**

Имя задается на английском языке.

ID карточки с вашим заданием из Trello можно увидеть в адресной строке, когда карточка открыта, либо в строке состояния браузера, при наведении на карточку с заданием.

## Оформление коммита

Старайтесь делать коммиты небольшими по объёму. Каждый коммит должен делать ровно одну вещь.

Заголовок коммита отделяется от основного описания 1 пустой строкой. Заголовок должен быть заполнен на английском языке, описание коммита разрешается заполнять на русском.
Необходимо придерживатся правила - не более 50 символов для заголовка коммита.

## Оформление pull request

Как правило, заголовок реквеста берется из вашего последнего коммита.
На проекте же необходимо указывать в качестве заголовка полное имя вашей текущей ветки.

Описание pull request разрешается заполнять на любом языке.
В последней строке описания необходимо добавить ссылку на вашу задачу в Trello.

**ВАЖНО:** В случае внесения изменений в базу данных в ходе решения задачи - необходимо обязательно заполнить файл [**dbChangeLog.xml**](../db/dbChangeLog.xml) - см. порядок работы с этим файлом ниже.

## Внесение изменений в базу данных

На проекте используется система версионирования изменений в БД - Liquibase.

При внесении изменений в базу данных во время решения своей задачи, необходимо добавлять в файл  [**dbChangeLog.xml**](../db/dbChangeLog.xml)  блок _\<changeSet>_.

В блоке _\<changeSet>_ указываются параметры **author** и **id**. 
**Id** должен быть уникальным - указывается id карточки с вашим заданием из Trello (можно увидеть в адресной строке, когда карточка открыта, либо в строке состояния браузера, при наведении на карточку с заданием). 

В блоке _\<changeSet>_ содержатся блоки _\<sql>_ и _\<rollback>_. 
Блок _\<sql>_ содержит запросы в формате SQL для внесения изменений в БД, каждый отдельный запрос  оканчивается - **;**
Блок _\<rollback>_ содержит запросы, которые полностью отменяют изменения блока _\<sql>_, для последующего возможного отката структуры БД.
При необходимости блок _\<comment>_ заполняется комментариями к запросам.

Блоки _\<changeSet>_ вносятся в порядке "сверху-вниз", т.е. ранние вверху, последующие запросы к БД ниже.

Пример доступен в файле [**dbChangeLog.example.xml**](../db/dbChangeLog.example.xml)

В случае конфликтов при слиянии веток в GIT с разных пул реквестов, **необходимо сохранять все блоки** _\<changeSet>_ !

Старые блоки _\<changeSet>_ не удаляются, в последующем их можно выносить в отдельные файлы, но dbChangeLog.xml все равно должен иметь на них ссылку (см. https://www.liquibase.org/documentation/include.html).

Документация по работе с liquibase: https://www.liquibase.org/documentation/index.html 

## Merge, на что обратить внимание

1. Никогда не делайте merge вашего pull request прямо на сайте GitHub - как правило ничего хорошего из этого не выйдет.
Вернитесь в среду разработки, "подлейте" свежие изменения с сервера с ветки dev и разрешите конфиликты при слиянии.
2. В случае конфликтов при слиянии веток с разных pull request, необходимо сохранять все блоки \<changeSet> в файле [dbChangeLog.xml](../db/dbChangeLog.xml) !!!

## Полезные lifehack

#### Чтобы не комитить файл в общий репозиторий:

`git update-index --skip-worktree myfile.txt`

Либо при коммите снимать галочку с ненужных файлов!

#### Помогают следить за актуальностью вашей ветки:

`git fetch` и после,
`git merge origin/dev`


#### Основные команды командной строки:
`git checkout -b <branch_name>` - создать новую ветку.

`git fetch` - подлить в кэш изменения с репозитория с GitHub.

`git merge` - подлить изменения с GitHub из своей ветки в свою локальную ветку.

`git merge origin/dev` - влить изменения с GitHub с ветки dev в свою локальную ветку.

`git push` - залить свои изменения на GitHub в свою ветку.


## Литература

Хороший курс по GIT:
https://stepik.org/course/3145

Официальное руководство на русском:
https://git-scm.com/book/ru/v2
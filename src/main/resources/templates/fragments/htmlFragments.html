<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <link rel="stylesheet" href="/css/style.css"/>
</head>
<body>
<th:block th:fragment="left-panel">
    <div class="col-md-1 sidebar">
        <ul class="nav nav-sidebar">
            <li class="active"><a href="/client">Таблица клиентов</a></li>
            <li><a href="/client/allClients">Таблица всех клиентов</a></li>

        </ul>
    </div>
</th:block>

<th:block th:fragment="top-navigation-panel">
    <div id="not-bar" class="container">
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <span id="logo-span" class="navbar-brand navbar-left">JM-CRM</span>
                    </ul>
                </div>

            </div>

            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/client">Доска</a></li>
                    <li><a href="/client/allClients">Все клиенты</a></li>
                    <li><a href="/student/all" sec:authorize="hasAnyAuthority('OWNER')">Все студенты</a></li>
                    <li><a href="/hr/students" sec:authorize="hasAnyAuthority('OWNER', 'ADMIN', 'HR','MENTOR')">Пропавшие
                        студенты</a></li>
                    <li><a href="/student-status/all" sec:authorize="hasAnyAuthority('OWNER','HR','MENTOR')">Статусы
                        обучения</a></li>
                    <li><a href="/client/mailing" sec:authorize="hasAnyAuthority('OWNER', 'ADMIN', 'MENTOR','HR')">Рассылка</a>
                    </li>
                    <li><a href="/template/all"
                           sec:authorize="hasAnyAuthority('OWNER', 'ADMIN','HR','MENTOR')">Шаблоны</a></li>
                    <li><a href="/vk/campaigns/all" sec:authorize="hasAnyAuthority('OWNER', 'ADMIN')">Продвижение</a>
                    </li>
                    <li><a href="/calls" sec:authorize="hasAnyAuthority('OWNER', 'ADMIN', 'MENTOR','HR')">Звонки</a>
                    </li>
                    <li><a href="/mentors" sec:authorize="hasAnyAuthority('OWNER', 'ADMIN')">Менторы</a></li>
                    <li><a href="/hr/managers" sec:authorize="hasAnyAuthority('OWNER', 'ADMIN')">Координаторы</a></li>
                    <li><a href="/analytics" sec:authorize="hasAnyAuthority('OWNER', 'ADMIN')">Аналитика</a></li>

                    <li th:if="${#httpServletRequest.getRequestURI() == '/client'}">
                        <div class="search-place">
                            <input id="search-clients" type="text" class="form-control" name="search"
                                   placeholder="Search"/>
                        </div>
                    </li>


                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li class="nav-item dropdown">
                        <a class="chat-notifications" id="chatNavbarDropdown" href="#" role="button"
                           data-toggle="dropdown" style="color: red;display: none;">Новые сообщения</a>
                        <div class="dropdown-menu" aria-labelledby="chatNavbarDropdown" id="chatNewMessageMenu">
                            <!--<a class="dropdown-item vk-items" th:id="chatNotifyItem" onclick="showModal(1)">Action</a>-->

                        </div>
                    </li>

                    <li class="dropdown" th:if="${#httpServletRequest.getRequestURI() == '/client'}"
                        sec:authorize="hasAnyAuthority('OWNER', 'ADMIN')">
                        <a class="glyphicon glyphicon-bell redBell"
                           th:style="${notifications.size() > 0} ? 'color:red' : ''" data-toggle="dropdown"
                           id="bell"></a>
                        <ul class="dropdown-menu notification-dropdown" id="Notify">
                            <th:block th:if="${notifications.size() > 0}">
                                <th:block>
                                    <li>
                                        <button
                                                type="button" data-toggle="modal"
                                                class="glyphicon glyphicon-trash pull-right"
                                                title="Очистить всё"
                                                th:onclick="'cleanAll()'" id="bucket">
                                        </button>
                                    </li>
                                </th:block>
                                <th:block th:each="notification : ${notifications}"
                                          th:if="${notification.client ne null and !notification.client.status.invisible}">
                                    <th:block
                                            th:if="${notification.type == T(com.ewp.crm.models.Notification.Type).COMMENT}">
                                        <li th:class="'menu' + ${notification.client.id}">
                                            <a data-toggle="modal" class="link-cursor-pointer notify"
                                               th:attrappend="data-target='#client-'+ ${notification.client.id}+ '-modal'"
                                               th:onclick="'markAsReadMenu('+ ${notification.client.id} +', 1)'"
                                               th:text="${'Вас упомянули в карточке ' + notification.client.name + ' ' + notification.client.lastName}">
                                            </a>
                                        </li>
                                    </th:block>
                                    <th:block
                                            th:if="${notification.type == T(com.ewp.crm.models.Notification.Type).SMS}">
                                        <li th:class="'menu' + ${notification.client.id}">
                                            <a data-toggle="modal" class="notification-header-btn sms-error-btn"
                                               th:attrappend="data-id=${notification.client.id}"
                                               th:text="${'Ошибка при отправке сообщения ' + notification.client.name + ' ' + notification.client.lastName}">
                                            </a>
                                        </li>
                                    </th:block>
                                    <th:block
                                            th:if="${notification.type == T(com.ewp.crm.models.Notification.Type).POSTPONE}">
                                        <li th:class="'menu' + ${notification.client.id}">
                                            <a data-toggle="modal" class="link-cursor-pointer notify"
                                               th:attrappend="data-target='#client-'+ ${notification.client.id}+ '-modal'"
                                               th:onclick="'markAsReadMenu('+ ${notification.client.id} +', 1)'"
                                               th:text="${'Отложенный клиент ' + notification.client.name + ' ' + notification.client.lastName} + ' возвращен на доску'">
                                            </a>
                                        </li>
                                    </th:block>
                                    <th:block
                                            th:if="${notification.type == T(com.ewp.crm.models.Notification.Type).NEW_USER}">
                                        <li th:class="'menu' + ${notification.client.id}">
                                            <a data-toggle="modal" class="link-cursor-pointer notify"
                                               th:attrappend="data-target='#client-'+ ${notification.client.id}+ '-modal'"
                                               th:onclick="'markAsReadMenu('+ ${notification.client.id} +', 1)'"
                                               th:text="${'На доску добавлена новая карточка ' + notification.client.name + ' ' + notification.client.lastName}">
                                            </a>
                                        </li>
                                    </th:block>
                                    <th:block
                                            th:if="${notification.type == T(com.ewp.crm.models.Notification.Type).ASSIGN_SKYPE}">
                                        <li th:class="'menu' + ${notification.client.id}">
                                            <a data-toggle="modal" class="link-cursor-pointer notify"
                                               th:attrappend="data-target='#client-'+ ${notification.client.id}+ '-modal'"
                                               th:onclick="'markAsReadMenu('+ ${notification.client.id} +', 1)'"
                                               th:text="${'На ' + notification.information + ' ' + 'у Вас запланирована беседа по Skype c' + ' ' + notification.client.name + ' ' + notification.client.lastName}">
                                            </a>
                                        </li>
                                    </th:block>
                                </th:block>

                            </th:block>
                            <th:block th:if="${notifications.size() == 0}">
                                <li><a>У вас нет новых оповещений</a></li>
                            </th:block>
                            <li><a id="noNotify"></a></li>
                        </ul>
                    </li>
                    <li>
                        <button data-toggle="dropdown" class="user-icon"
                                th:text="${#strings.substring(#authentication.getPrincipal().getFirstName(), 0,1)
                                     + #strings.substring(#authentication.getPrincipal().getLastName(), 0,1)}"
                                th:value="${#authentication.getPrincipal().getFirstName()} + ' ' + ${#authentication.getPrincipal().getLastName()}">
                        </button>
                        <ul class="dropdown-menu">
                            <li><a href="/user/customize">Настройки</a></li>

                            <li sec:authorize="hasAnyAuthority('OWNER', 'ADMIN','HR','MENTOR')"><a
                                    th:href="'/admin/user/' + ${#authentication.getPrincipal().getId()}">Профиль</a>
                            </li>
                            <li>
                                <a href="javascript:;" onclick="document.getElementById('logout').submit();">Выход</a>
                                <form action="/logout" id="logout" method="post">
                                    <input type="hidden"
                                           th:name="${_csrf.parameterName}"
                                           th:value="${_csrf.token}"/>
                                </form>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
        <br/>
    </div>
</th:block>

<th:block th:fragment="header">
    <link rel="icon" type="image/png" th:href="@{/images/favico.png}"/>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
          crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
          crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"/>
    <script th:src="@{/js/jquery-3.2.0.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}" type="text/javascript"></script>
    <script type="text/javascript" th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
</th:block>

<th:block th:fragment="custom-style">

    <!--removed  th:if="${#authorization.expression('isAuthenticated()')}" from the line below-->
    <!--card from 'Форма: Java Test' doesn't appear on a board with it-->
    <style th:inline="text">
        body {
            background-color: [ [${#authentication.getPrincipal().colorBackground}] ];
        }

        .navbar-fixed-top {
            background-image: -webkit-gradient(linear, left top, left bottom, from([ [${#authentication.getPrincipal().colorBackground}] ]), to([ [${#authentication.getPrincipal().colorBackground}] ]));
            border-color: [ [${#authentication.getPrincipal().colorBackground}] ];
        }
    </style>
</th:block>

<th:block th:fragment="slackLinkModal">
    <div th:id="slackLinkModal" class="modal fade client-contract-modal" role="dialog" data-keyboard="false">
        <div class="modal-dialog modal-md" style="margin-top: 18%;">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="col-sm">
                        <h4 class="col-sm-11">Ссылка:</h4>
                        <button type="button" class="close col-sm-1" th:onclick="'backUrl()'" data-dismiss="modal">
                            &times;
                        </button>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="form-group">
                            <div class="row">
                                <div class="col-sm">
                                    <input class="form-control" type="text" id="slack-invite-link-text"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="comments">
    <div class="modal-footer modal-comments">
        <div class="comments">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <span><h4>Комментарии:</h4></span>
                    <div class="form-group comment-div">
                        <textarea class="form-control textcomplete graur-class" th:id="'new-text-for-client'"
                                  placeholder="Напишите комментарий"></textarea>
                    </div>
                    <ul class="list-group main-modal-comment">
                    </ul>
                </div>
            </div>
        </div>
    </div>
</th:block>


<!--Отправка фиксированного сообщения во все сети.-->
<th:block th:fragment="sendTemplateModal">
    <div class="modal fade fix-modal" th:id="'sendTemplateModal'" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Подтвердите свое действие</h5>
                </div>
                <div class="modal-body">
                    <div class="form-сheck">
                        <form class="box-modal">
                            <button type="button" class="btn btn-success btn-xs select_all ">Выбрать все</button>
                            <button type="button" class="btn btn-success btn-xs deselect_all">Отменить все</button>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <span class="send-fixed-template"></span>
                    <button type="button" class="btn btn-primary send-all-message">Отправить</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="downloadModal">

    <!-- Modal -->
    <div class="modal fade" id="downloadModal" tabindex="-1" role="dialog" aria-labelledby="downloadModal"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ModalLabel">Скачать данные</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div id="modal-body">
                    <div id="checkboxes">
                        <div class="container">
                            <label class="checkbox" th:for="name">Имя</label>
                            <input type="checkbox" th:value="name" th:id="name"/>
                        </div>
                        <div class="container">
                            <label class="checkbox" th:for="lastName">Фамилия</label>
                            <input type="checkbox" th:value="lastName" th:id="lastName"/>
                        </div>
                        <div class="container">
                            <label class="checkbox" th:for="email" th:value="email" th:text="Email"></label>
                            <input type="checkbox" th:value="email" th:id="email"/>
                        </div>
                        <div class="container">
                            <label class="checkbox" th:for="phoneNumber">Номер телефона</label>
                            <input type="checkbox" th:value="phoneNumber" th:id="phoneNumber"/>
                        </div>
                        <th:block th:each="socialNetworkType : ${socialNetworkTypes}">
                            <div class="container">
                                <label class="checkbox" th:for="${socialNetworkType.id}"
                                       th:text="${socialNetworkType.name}"></label>
                                <input type="checkbox" th:value="${socialNetworkType.name}"
                                       th:id="${socialNetworkType.id}"/>
                            </div>
                        </th:block>
                    </div>
                    <h5>Выберите тип файла: </h5>
                    <div class="container" id="radiobuttons">
                        <div class="container">
                            <label class="radio">
                                <input type="radio" class="custom-control-input" checked="checked" value="txt"
                                       name="fileType"/>TXT
                            </label>
                        </div>
                        <div class="container">
                            <label class="radio">
                                <input type="radio" class="custom-control-input" value="xlsx" name="fileType"/>Excel
                            </label>
                        </div>
                        <div class="container">
                            <label class="radio">
                                <input type="radio" class="custom-control-input" value="csv" name="fileType"/>CSV
                            </label>
                        </div>
                    </div>
                    <div class="col-xs-12">
                        <input type="form" th:id="delimeter"/>
                        <label th:for="delimeter">Разделитель</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                    <button type="submit" class="btn btn-primary" role="button" id="clientData">Скачать</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="reAvailableUser">
    <div th:each="usr : ${users}">
        <div class="modal fade" th:id="'reAvailableUserModal' + ${usr.id}" tabindex="-1" role="dialog"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Подтвердите свое действие</h5>
                    </div>
                    <div class="modal-body">
                        <h6>Вы уверены, что хотите изменить права доступа пользователя?</h6>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" th:onclick="'reAvailableUser('+ ${usr.id} + ')'">
                            Да
                        </button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="deleteUser">
    <div class="modal fade" id="deleteUserModal" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Перед удалением выберите пользователя для передачи клиентов</h5>
                </div>
                <div class="modal-body">
                    <form id="deleteUserForm">
                        <div class="custom-control custom-radio">
                            <table id="usersTable" class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Пользователи</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                            <h6>Вы уверены, что хотите удалить пользователя?</h6>
                            <button type="submit" class="btn btn-primary">Да</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="deleteVkTrackedClub">
    <div th:each="club : ${vkTrackedClub}">
        <div class="modal fade" th:id="'deleteVkTrackedClubModal' + ${club.id}" tabindex="-1" role="dialog"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-cfontent">
                    <div class="modal-header">
                        <h5 class="modal-title">Подтвердите свое действие</h5>
                    </div>
                    <div class="modal-body">
                        <h6>Вы уверены, что хотите удалить отслеживаемую группу ВК?</h6>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary"
                                th:onclick="'deleteVkTrackedClub('+ ${club.id} + ')'">Да
                        </button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
</th:block>

<th:block th:fragment="deleteVkTrackedClub">
    <div th:each="club : ${vkTrackedClub}">
        <div class="modal fade" th:id="'deleteVkTrackedClubModal' + ${club.id}" tabindex="-1" role="dialog"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Подтвердите свое действие</h5>
                    </div>
                    <div class="modal-body">
                        <h6>Вы уверены, что хотите удалить отслеживаемую группу ВК?</h6>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary"
                                th:onclick="'deleteVkTrackedClub('+ ${club.id} + ')'">Удалить
                        </button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="updateVkTrackedClub">
    <div th:each="club : ${vkTrackedClub}">
        <div class="modal fade" th:id="'updateVkTrackedClubModal' + ${club.id}" tabindex="-1" role="dialog"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Изменить данные сообщества</h5>
                    </div>
                    <div class="modal-body">
                        <label for="groupName">Name</label>
                        <input type="text" id="groupName" name="groupName"
                               class="form-control"
                               th:value="${club.groupName}"/>
                        <label for="groupId">GroupId</label>
                        <input type="text" id="groupId" name="groupId"
                               class="form-control" disabled="disabled"
                               th:value="${club.groupId}"/>
                        <label for="token">token</label>
                        <input type="text" id="token" name="token"
                               class="form-control"
                               th:value="${club.token}"/>
                        <label for="clientId">clientId</label>
                        <input type="text" id="clientId" name="clientId"
                               class="form-control" disabled="disabled"
                               th:value="${club.clientId}"/>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary"
                                th:onclick="'updateVkTrackedClub('+ ${club.id} + ')'">Обновить
                        </button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="addVkTrackedClub">
    <div class="modal fade" th:id="addVkTrackedClubModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Добавить новое отслеживаемое сообщество</h5>
                </div>
                <div class="modal-body">
                    <label for="groupName">Name</label> <span class="glyphicon glyphicon-question-sign"
                                                              title="Введите название отслеживаемой группы"
                                                              aria-hidden="true"></span>
                    <input type="text" id="newGroupName" name="groupName"
                           class="form-control"/>
                    <label for="groupId">GroupId</label> <span class="glyphicon glyphicon-question-sign"
                                                               title="Введите id группы
                                                                             пример: https://vk.com/club171490538, id = 171490538"
                                                               aria-hidden="true"></span>
                    <input type="text" id="newGroupId" name="groupId"
                           class="form-control"/>
                    <label for="token">token</label> <span class="glyphicon glyphicon-question-sign"
                                                           title="Защищенный ключ доступа сообщества(своего)
                                                           перейдите в группу, затем перейдите в раздел управление - работа с API и скопируйте ключ доступа(если ключа нет - нажмите сгенерировать ключ)"
                                                           aria-hidden="true"></span>
                    <input type="text" id="newToken" name="token"
                           class="form-control"/>
                    <label for="clientId">clientId</label> <span class="glyphicon glyphicon-question-sign"
                                                                 title="Перейдите в раздел - для разработчиков, выберите свое приложение, перейдите в настройки и скрпипуйие id приложения"
                                                                 aria-hidden="true"></span>
                    <input type="text" id="newClientId" name="clientId"
                           class="form-control"/>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" th:onclick="'addVkTrackedClub()'">Добавить</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="addSocialNetworkType">
    <div id="addSocialType" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <form role="form" id="addTypeForm" th:action="@{/admin/user/addSocialNetworkType}" method="post">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            &times;
                        </button>
                        <h4> Add SocialNetwork Type </h4>
                    </div>
                    <div class="modal-body container-fluid row">
                        <div class="col-md-4 col-md-offset-4">

                            <div class="form-group text-center">
                                <label for="name">Name</label>
                                <input type="text" id="name" name="name" class="form-control"
                                       placeholder="Name"/>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-info">Add
                        </button>
                        <button type="button" class="btn btn-secondary"
                                data-dismiss="modal">
                            Close
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</th:block>

<th:block th:fragment="changeStatusNameModal">
    <div class="modal fade" th:id="'renameStatusModal' + ${status.id}" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="renameStatusModalTitle" th:text="${status.name}"></h5>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label th:for="'change-status-name' + ${status.id}">Новое название статуса</label>
                        <input type="text" class="form-control" th:id="'change-status-name' + ${status.id}"
                               maxlength="30" th:value="${status.name}"/>
                        <table style="margin: 2%">
                            <tr>
                                <td><label th:for="'trial_offset_' + ${status.id}">Длительность пробного периода на этом
                                    статусе</label></td>
                                <td><input th:id="'trial_offset_' + ${status.id}" type="number"
                                           th:value="${status.trialOffset}"/></td>
                            </tr>
                            <tr>
                                <td><label th:for="'next_payment_offset_' + ${status.id}">Длительность учебного
                                    интервала в днях</label></td>
                                <td><input th:id="'next_payment_offset_' + ${status.id}" type="number"
                                           th:value="${status.nextPaymentOffset} - ${status.trialOffset}"/></td>
                            </tr>
                        </table>
                        <div class="form-group" th:id="'checkbox_status_roles_' + ${status.id} "
                             sec:authorize="hasAnyAuthority('OWNER', 'ADMIN')">
                            <label th:for="'checkbox_status_roles_' + ${status.id} ">Роли</label>
                            <div th:id="'current_status_roles_' + ${status.id} ">
                                <span th:each="role : ${status.role}" th:value="${role.id}"></span>
                            </div>
                            <div class="checkbox" th:each="role : ${roles}">
                                <input type="checkbox" th:id="'checkbox-role-' + ${role.id} + ${status.id}"
                                       th:value="${role.id}"/>
                                <label th:for="'checkbox-role-' + ${role.id} + ${status.id}"
                                       th:text="${role.roleName}"></label>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Закрыть</button>
                    <button type="button" class="btn btn-primary"
                            th:onclick="'changeStatusName(\''+ ${status.id} +'\')'">Сохранить
                    </button>
                </div>
            </div>
        </div>
    </div>
</th:block>
<th:block th:fragment="deleteNotifications">
    <div id="delete-client-modal" class="modal" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Подтвердите свое действие</h5>
                </div>
                <div class="modal-body">
                    <p>Вы уверены, что хотите удалить карточк - у(ки), на котор - ой(ых) есть непрочитанные уведомления?
                        Если выбирете "да", то все уведомления будут удалены.</p>
                </div>
                <div class="modal-footer">
                    <button id="delete-client-btn" type="button" class="btn btn-primary" data-dismiss="modal">Да
                    </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
</th:block>
<th:block th:fragment="deleteStatusModal">
    <div class="modal fade" id="deleteStatusModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Подтвердите свое действие</h5>
                </div>
                <div class="modal-body">
                    <h6>Вы уверены, что хотите удалить статус и содержащих его клиентов?</h6>
                </div>
                <div class="modal-footer">
                    <button id="delete-status-btn" type="button" class="btn btn-primary">Да</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="createDefaultStatusModal">
    <div class="modal fade" th:if="${statuses.size()== 0}" th:id="createDefaultStatus" tabindex="-1" role="dialog"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Создание нового статуса</h5>
                </div>
                <div class="modal-body">
                    <h6>Статус по умолчанию не задан. Введите имя нового статуса</h6>
                    <div class="form-group">
                        <input id="default-status-name" type="text" class="form-control"
                               placeholder="Введите название статуса"/>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="createNewStatus()">Создать</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<!--Отправка кастомного сообщения в VKONTAKTE , из модального окна с расширенной информацией-->
<th:block th:fragment="vkontakteMessageTemplateModal">
    <div class="modal fade" th:id="'customVKMessageTemplate'" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header padding-top-bot">
                    <h5>Отправить сообщение во вконтакте?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body padding-bot">
                    <div class="form-group">
                            <textarea th:id="'custom-VKTemplate-body'" class="form-control"
                                      placeholder="Основной текст" rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <span class="send-custom-vk-status"></span>
                    <button type="button" class="btn btn-primary send-vk-btn">Отправить</button>
                </div>
            </div>
        </div>
    </div>
</th:block>


<!--Модельное окно чата с клиентом в контакте VKONTAKTE-->
<th:block th:fragment="vkontakteIMModal">
    <div class="modal fade modal-vk" th:id="'customVKIMMessage'" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header padding-top-bot">
                    <a id="VK-IM-LINK" href='https://vk.com/' target='_blank'>
                        <div id="VK-IM-HEADER">Чат с пользователем</div>
                    </a>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="im-vk-body" class="modal-body padding-bot" style="max-height: 400px; overflow-y: auto;">
                    <!--here js insert vk_messages!-->

                </div>
                <div class="modal-body padding-bot">
                    <div class="form-group">
                            <textarea id="IM-VK-Text" class="form-control"
                                      placeholder="Напишите сообщение..." rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <span class="send-custom-vk-im-status"></span>
                    <button type="button" id="send-vk-im-btn" class="btn btn-primary send-vk-im-btn">Отправить</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<!--Отправка кастомного сообщения в EMAIL , из модального окна с расширенной информацией-->
<th:block th:fragment="emailMessageTemplateModal">
    <div class="modal fade" th:id="'customEmailMessageTemplate'" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header padding-top-bot">
                    <h5>Отправить сообщение на e-mail?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body padding-bot">
                    <div class="form-group">
                            <textarea th:id="'custom-EmaileTemplate-body'" class="form-control"
                                      placeholder="Основной текст" rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <span class="send-email-err-status"></span>
                    <button type="button" class="btn btn-primary send-email-btn">Отправить</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<!--//Отправка кастомных сообщений во все сети с карточки-->
<th:block th:fragment="customMessageTemplateModal">
    <div class="modal fade custom-modal" th:id="'customMessageTemplate'" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="form-group">
                            <textarea th:id="'custom-eTemplate-body'" class="form-control"
                                      placeholder="Основной текст"></textarea>
                    </div>
                    <div class="form-сheck">
                        <form class="box-modal">
                            <button type="button" class="btn btn-success btn-xs select_all">Выбрать все</button>
                            <button type="button" class="btn btn-success btn-xs deselect_all">Отменить все</button>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <span class="send-custom-template"></span>
                    <button type="button" class="btn btn-primary send-all-custom-message">Отправить</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="updateSocialNetworkType">
    <div th:attr="id=${socialNetworkType.id}" class="modal fade" role="dialog">

        <div class="modal-dialog">
            <form role="form" id="updateTypeForm" th:action="@{/admin/user/updateSocialNetworkType}" method="post">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            &times;
                        </button>
                        <h4> Update SocialNetwork Type </h4>
                    </div>
                    <div class="modal-body container-fluid row">
                        <div class="col-md-4 col-md-offset-4">

                            <div class="form-group text-center">
                                <label for="updateType">Name</label>
                                <input type="text" id="updateType" name="name"
                                       class="form-control"
                                       th:value="${socialNetworkType.name}"/>

                                <input type="hidden" id="typeId" name="id" th:value="${socialNetworkType.id}"/>

                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-info">Update
                        </button>
                        <button type="button" class="btn btn-secondary"
                                data-dismiss="modal">
                            Close
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</th:block>

<th:block th:fragment="hideClient">
    <div class="modal fade" th:id="'hideClient' + ${client.id}" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Скрыть клиента</h5>
                </div>
                <div class="modal-body">
                    <h6>Вы уверены, что хотите удалить статус? Все клиенты статуса будут перемещены в архив</h6>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" th:onclick="'hideClient(\''+ ${client.id} +'\')'">OK
                    </button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="clientHistory">
    <div class="modal-header">
        <div class="panel-group" id="actionsAccordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#actionsAccordion" class="upload-history collapsed">Действия</a>
                    </h4>
                </div>
                <div th:id="'collapse'" class="panel-collapse collapse client-collapse history">
                    <div class="panel-body">
                        <table class="table table-bordered history-line" th:id="'client-string-history'">
                            <thead>
                            <tr class="head-table">
                                <th>
                                    <button type="button" class="btn btn-secondary">Подробности</button>
                                </th>
                                <th>
                                    <button id="date" onclick="resortClientHistory(this)" type="button"
                                            class="btn btn-default btn-secondary">Дата<i
                                            class="fa fa-fw fa-sort-down"></i></button>
                                </th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <button type="button" data-page="1" class="btn upload-more-history">Загрузить ещё</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="historyAllCalls">
    <div class="modal-header">
        <div class="panel-group" id="actionCallsModal">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#actionCallsModal"
                           class="upload-calls-history collapsed">Действия</a>
                    </h4>
                </div>
                <div th:id="'calls-collapse'" class="all-calls panel-collapse collapse">
                    <div class="panel-body">
                        <table class="table table-bordered calls-history-line" th:id="'calls-history-all-client'">
                            <tbody></tbody>
                        </table>
                        <button type="button" data-page="1" class="btn upload-more-calls-history" style="width: 100%">
                            Загрузить ещё
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="clientHistoryForClientInfo">

</th:block>

<th:block th:fragment="sms_error_modal">
    <div class="modal fade" role="dialog" id="sms_error_modal">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Ошибки sms</h4>
                </div>
                <div class="modal-body">
                    <!-- SMS INFO -->
                    <table>
                        <tbody></tbody>
                    </table>
                    <!--/ SMS INFO -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="clear_sms_errors">Очистить
                    </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="client_description_modal">
    <div id="clientDescriptionModal" class="modal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-body">
                    <form role="form">
                        <div class="form-group">
                            <h5>Введите заметку</h5>
                            <textarea class="form-control" id="content-area" rows="4"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-sm" id="save-description">Сохранить</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="deleteNewUser">
    <div th:each="newusr : ${newUsers}">
        <div class="modal fade" th:id="'deleteNewUserModal' + ${newusr.id}" tabindex="-1" role="dialog"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Подтвердите свое действие</h5>
                    </div>
                    <div class="modal-body">
                        <h6>Вы уверены, что хотите удалить нового пользователя?</h6>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" th:onclick="'deleteNewUser('+ ${newusr.id} + ')'">
                            Да
                        </button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="status_name_in_selection">
    <div th:each="status : ${statuses}">
        <option th:text="${status.name}" th:value="${status.id}"></option>
    </div>
</th:block>

<th:block th:fragment="clientsForStatus">
    <div class="portlet common-modal"
         th:each="client : ${status.clients}"
         th:if="${!client.hideCard}"
         th:value="${client.id}"
         th:onmouseover="'displayOption('+${client.id}+')'"
         th:attrprepend="data-card-id=${client.id}">

        <div class="portlet-title portlet-title-groups">
            <div class="portlet-title__group-left">
                <div class="clickModal text-board" th:id="'info-client' + ${client.id}"
                     style="margin-left: 2px;display: inline-block;height: 12px;">

                    <p th:if="${client.ownerUser != null}" style="display:none"
                       th:text="${client.ownerUser.fullName}"></p>

                    <span th:id="'chat-notification'+${client.id}"
                          class="chat-notification glyphicon glyphicon-send pull-right"
                          style="color: darkblue;display: none;"></span>

                    <th:block th:each="notification_comment:${notifications_type_comment}">
                        <th:block th:if="${notification_comment.client == client}">
                                   <span id="notification"

                                         class="notification glyphicon glyphicon-bell"
                                         style="color: red"></span>
                        </th:block>

                    </th:block>

                    <th:block th:each="notification_new_user:${notifications_type_new_user}">
                        <th:block th:if="${notification_new_user.client == client}">
                                   <span id="2у notification-new"

                                         class="notification glyphicon glyphicon-bell"
                                         style="color: red"></span>
                        </th:block>

                    </th:block>

                    <th:block th:each="notification_postpone:${notifications_type_postpone}">
                        <th:block th:if="${notification_postpone.client == client}">
                                   <span th:id="'notification-postpone'+${client.id}"
                                         class="glyphicon glyphicon-time"
                                         style="color: red" th:onclick="'markAsReadMenu('+ ${client.id} +',0)'"></span>
                        </th:block>

                    </th:block>
                    <div sec:authorize="hasAnyAuthority('MENTOR')">
                                <span class="ownerMentorId" th:if="${client.ownerMentor != null}" style="display:none"
                                      th:text="${client.ownerMentor.id}"></span>
                    </div>
                    <span th:if="${client.ownerUser != null}" class="user-icon_card"
                          style="background: transparent;height: 15px; font-size: 12px;font-weight: bold;"
                          th:text="${#strings.substring(client.ownerUser.firstName, 0,1)
                                  + #strings.substring(client.ownerUser.lastName, 0,1)
                                  }"
                          th:value="${client.ownerUser.firstName} + ' ' + ${client.ownerUser.lastName}"
                          th:id="'own-' + ${client.id}">
                                </span>
                    <span th:if="${client.ownerMentor != null}" class="mentor-icon_card"
                          style="background: transparent;height: 15px; font-size: 12px;font-weight: bold;"
                          th:text="' Ментор: ' + ${#strings.substring(client.ownerMentor.firstName, 0,1)
                                  + #strings.substring(client.ownerMentor.lastName, 0,1)
                                  }"
                          th:value="${client.ownerMentor.firstName} + ' ' + ${client.ownerMentor.lastName}"
                          th:id="'mn-' + ${client.id}">
                                </span>

                </div>
            </div>

            <div class="portlet-title__group-right">

                        <span class="btn-group" th:id="'notiff' +${client.id}">
                            <!-- EMAIL SEND/EDIT TEMPLATE BTN -->
                            <button name="emailTmplList" th:id="'emailTmplList' +${client.id}" type="button"
                                    style="margin-right: -8px"
                                    class="f-18 icon-email-card " data-toggle="dropdown">
                            </button>


                            <ul class="dropdown-menu" th:if="${emailTmpl.size()!=0}">
                                <li th:id="'eTemplate' + ${template.id}" th:each="template : ${emailTmpl}">
                                    <a class="glyphicon glyphicon-ok portlet-send-btn"
                                       th:if="${!template.hasBody()}"
                                       th:id="'eTemplateBtn' + ${template.id}"
                                       data-toggle="modal"
                                       th:attrappend="data-target='#sendTemplateModal'"
                                       th:text="' ' + ${template.name}"
                                       th:attrprepend="data-template-id=${template.id}"></a>
                                    <a class="glyphicon glyphicon-plus portlet-custom-btn"
                                       th:if="${template.hasBody()}"
                                       th:id="'eTemplateBtn' + ${template.id}"
                                       data-toggle="modal" th:attrappend="

                               data-target='#customMessageTemplate'"
                                       th:text="' ' + ${template.name}"
                                       th:attrprepend="data-template-id=${template.id}"></a>
                                </li>
                            </ul>
                            <!--/ EMAIL SEND/EDIT TEMPLATE BTN -->

                            <!-- SMS ERROR INFO BTN -->
                            <th:block th:each="notification_sms:${notifications_type_sms}">
                                <th:block th:if="${notification_sms.client == client}">
                                    <button type="button"
                                            style="color:red"
                                            class="glyphicon glyphicon-exclamation-sign sms-error-btn"
                                            th:attrappend="data-id=${client.id}"></button>
                                </th:block>
                            </th:block>
                            <!--/ SMS ERROR INFO BTN -->

                        </span>


                <span class="dropdown">
                            <button type="button" th:id="'option_' +${client.id}"
                                    class="glyphicon glyphicon-pencil option"
                                    data-toggle="dropdown"
                                    style="display:inline-block"></button>

                            <ul class="dropdown-menu">
                              <div sec:authorize="hasAnyAuthority('OWNER','ADMIN','HR')">
                                <th:block>
                                    <li class="dropdown-header">Назначить работника</li>
                                    <li th:each="worker : ${users_without_mentors}">
                                        <a th:text="${worker.fullName}"
                                           th:onclick="'assignUser('+${client.id}+','+${worker.id}+','+${user.id}+')'"></a>
                                    </li>
                                    <li class="divider"></li>
                                </th:block>
                                <th:block>
                                    <li class="dropdown-header">Назначить ментора</li>
                                    <li th:each="worker : ${mentors}">
                                        <a th:text="${worker.fullName}"
                                           th:onclick="'assignMentor('+${client.id}+','+${worker.id}+','+${user.id}+')'"></a>
                                    </li>
                                    <li class="divider"></li>
                                </th:block>
                                <li class="dropdown-header">Скрыть в статус</li>
                                <li th:each="inv_status:${statuses}"
                                    th:if="${inv_status.invisible} and ${inv_status.name != 'deleted'}">
                                    <a class="invisible-client" th:text="${inv_status.name}"
                                       th:attrappend="data-clientid=${client.id}, data-statusid=${inv_status.id}"></a>
                                </li>
                                <li class="divider"></li>
                              </div>

                                <li class="open-description-btn" th:attr="data-id=${client.id}">
                                    <a>Добавить заметку</a>
                                </li>
                              <div sec:authorize="hasAnyAuthority('OWNER','ADMIN','HR')">
                                <th:block>
                                    <li>
                                        <a th:onclick="'unassign('+ ${client.id} +')'">Убрать работника с
                                            карточки</a>
                                    </li>
                                </th:block>
                                <th:block>
                                    <li>
                                        <a th:onclick="'unassignMentor('+ ${client.id} +')'">Убрать ментора с
                                            карточки</a>
                                    </li>
                                </th:block>
                                <th:block>
                                    <li class="delete-client" th:attrappend="data-clientid=${client.id} ">
                                        <a>Удалить клиента</a>
                                    </li>
                                </th:block>
                              </div>
                            </ul>
                        </span>
            </div>

        </div>

        <div class="portlet-header" th:name="'client-'+${client.id} + '-modal'"
             th:text="${client.name} + ' ' + ${client.lastName}"
             th:attr="client-id=${client.id} "
             th:onclick="'showActiveClientDetails('+ ${client.id}+');changeUrl(\'/client\', '+ ${client.id} +');'">
        </div>

        <div class="portlet-body" th:name="'client-'+${client.id} + '-modal'"
             th:attr="client-id=${client.id} "
             th:onclick="'showActiveClientDetails('+ ${client.id}+');'">

            <div class="search_text" th:text="${client.name} + ' ' + ${client.lastName} + ' ' + ${client.email} + ' ' +
                    ${client.phoneNumber} + ' ' + ${client.skype} + ' ' + ${client.socialProfiles} + ' ' + ${client.city} + ' ' +
                    ${client.country}" hidden="hidden">
            </div>

        </div>
    </div>

    <div th:replace="fragments/htmlFragments::customMessageTemplateModal"></div>
    <div th:replace="fragments/htmlFragments::sendTemplateModal"></div>

    <div th:replace="fragments/contract-client-setting-modal::contractClientSettingModal"></div>
    <div th:replace="fragments/contract-client-link-modal::contractClientLinkModal"></div>
    <div th:replace="fragments/other-information-link::otherInformationLink"></div>
    <div th:replace="fragments/other-information-value::otherInformationValue"></div>
    <div th:replace="fragments/htmlFragments::sms_error_modal"></div>
    <div th:replace="fragments/conversations::conversationsModal"></div>

    <div th:replace="fragments/htmlFragments::client_description_modal"
         sec:authorize="hasAnyAuthority('HR','MENTOR','USER')"></div>

    <div sec:authorize="hasAnyAuthority('OWNER','ADMIN','HR')">
        <div th:replace="fragments/modal-client-history-message::modalClientHistoryMessage"></div>
        <div th:replace="fragments/htmlFragments::client_description_modal"></div>
    </div>

    <script type="text/javascript" th:src="@{/js/doashboard.js}"></script>
</th:block>

</body>
</html>

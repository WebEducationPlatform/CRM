<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
</head>
<body>
<th:block th:fragment="left-panel">
    <div class="col-md-1 sidebar">
        <ul class="nav nav-sidebar">
            <li class="active"><a href="/client">Таблица клиентов</a></li>
            <li><a href="/client/allClients">Таблица всех клиентов</a></li>

        </ul>
    </div>
</th:block>

<th:block th:fragment="top-navigation-panel">
    <div class="container">
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="navbar-header">
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <span id="logo-span" class="navbar-brand navbar-left">JM-CRM</span>
</ul>
            </div>

        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="/client">Доска</a></li>
                <li><a href="/client/allClients">Все клиенты</a></li>
                <li th:if="${#httpServletRequest.getRequestURI() == '/client'}" >
                   <div class="search-place">
                       <input id="search-clients" type="text" class="form-control" name="search" placeholder="Search" />
                   </div>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a class="glyphicon glyphicon-bell redBell" th:style="${notifications.size() > 0} ? 'color:red' : ''" data-toggle="dropdown"></a>
                    <ul class="dropdown-menu">
                        <th:block th:if="${notifications.size() > 0}">
                            <th:block th:each="notification : ${notifications}">
                                <th:block th:if="${notification.type == T(com.ewp.crm.models.Notification.Type).COMMENT}">
                                    <li th:class="'menu' + ${notification.client.id}">
                                    <a data-toggle="modal" class="link-cursor-pointer notify"
                                       th:attrappend="data-target='#client-'+ ${notification.client.id}+ '-modal'"
                                       th:onclick="'markAsReadMenu('+ ${notification.client.id} +')'"
                                       th:text="${'Вас упомянули в карточке ' + notification.client.name + ' ' + notification.client.lastName}">
                                    </a>
                                    </li>
                                </th:block>
                                <th:block th:if="${notification.type == T(com.ewp.crm.models.Notification.Type).SMS}">
                                    <li th:class="'menu' + ${notification.client.id}">
                                        <a data-toggle="modal" class="notification-header-btn"
                                           th:attrappend="data-target='#sms-error-modal_' + ${notification.client.id}"
                                           th:text="${'Ошибка при отправке сообщения ' + notification.client.name + ' ' + notification.client.lastName}">
                                        </a>
                                    </li>
                                </th:block>
                                <th:block th:if="${notification.type == T(com.ewp.crm.models.Notification.Type).POSTPONE}">
                                    <li th:class="'menu' + ${notification.client.id}">
                                        <a data-toggle="modal" class="link-cursor-pointer notify"
                                           th:attrappend="data-target='#client-'+ ${notification.client.id}+ '-modal'"
                                           th:onclick="'markAsReadMenu('+ ${notification.client.id} +')'"
                                           th:text="${'Отложенный клиент ' + notification.client.name + ' ' + notification.client.lastName} + ' возвращен на доску'">
                                        </a>
                                    </li>
                                </th:block>
                            </th:block>
                        </th:block>
                        <th:block th:if="${notifications.size() == 0}">
                            <li><a>У вас нет новых оповещений</a></li>
                        </th:block>
                    </ul>
                </li>
                <li>
                    <button data-toggle="dropdown" class="user-icon"
                            th:text="${#strings.substring(#authentication.getPrincipal().getFirstName(), 0,1)
                                     + #strings.substring(#authentication.getPrincipal().getLastName(), 0,1)}"
                            th:value="${#authentication.getPrincipal().getFirstName()} + ' ' + ${#authentication.getPrincipal().getLastName()}">
                    </button>
                   <ul class="dropdown-menu">
                                           <li><a href="/user/customize">Настройки</a></li>

                                           <li sec:authorize="hasAuthority('ADMIN')"><a th:href="'/admin/user/' + ${#authentication.getPrincipal().getId()}">Профиль</a></li>
                                           <li><a href="/logout">Выход</a></li>
                                      </ul>
                </li>
            </ul>
        </div>
    </nav>
    </div>
</th:block>

<th:block th:fragment="header">
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
          crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
          crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"/>
    <script th:src="@{/js/jquery-3.2.0.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}" type="text/javascript"></script>

    <script type="text/javascript" th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
</th:block>

<th:block th:fragment="comments">
    <div class="modal-footer modal-comments">
        <div class="comments">
            <div class="panel panel-default">
                <div class="panel-heading">
            <span><h4>Комментарии:</h4></span>
            <div class="form-group">
                <textarea class="form-control textcomplete" th:id="'new-text-for-client' + ${client.id}"
                          placeholder="Напишите комментарий"></textarea>
                <button class="btn btn-sm btn-success comment-button"
                        th:onclick="'sendComment(' + ${client.id} + ', \'test_message\')'">Cохранить
                </button>
            </div>
            <ul class="list-group" th:id="'client-'+${client.id}+'comments'">
                <li class="list-group-item comment-item" th:each="comment : ${client.comments}"
                    th:if="${comment.mainComment == null}">
                    <div th:id="'comment' + ${comment.id}" th:class="comment">
                        <span class="comment-name"
                              th:text="@{__${comment.user.lastName}__ __${comment.user.firstName}__}"></span>
                        <span th:if="${user == comment.user}" class="glyphicon glyphicon-remove comment-functional"
                              th:onclick="'deleteComment('+ ${comment.id} + ')'"></span>
                        <span th:if="${user == comment.user}"
                              class="edit-comment glyphicon glyphicon-pencil comment-functional"></span>
                        <span class="hide-show glyphicon glyphicon-comment comment-functional"></span>
                        <p class="comment-text" th:text="${comment.getContent()}"></p>
                        <div class="form-answer">
                            <div class="form-group">
                                <textarea class="form-control textcomplete"
                                          th:id="'new-answer-for-comment' + ${comment.id}"
                                          placeholder="Напишите ответ"></textarea>
                                <button class="btn btn-md btn-success comment-button"
                                        th:onclick="'sendAnswer(' + ${comment.id} + ', \'test_message\')'">Cохранить
                                </button>
                            </div>
                        </div>
                        <div class="form-edit">
                            <div class="form-group">
                                <textarea class="form-control edit-textarea textcomplete"
                                          th:id="'edit-comment' + ${comment.id}"
                                          placeholder="Редактор"></textarea>
                                <button class="btn btn-md btn-success comment-button"
                                        th:onclick="'editComment(' + ${comment.id} + ')'">Отредактировать
                                </button>
                            </div>
                        </div>
                        <ul class="answer-list comment-item"
                            th:id="'comment-'+${comment.id}+'answers'">
                            <li th:each="answer : ${comment.answers}">
                                <div th:id="'comment' + ${answer.id}" th:class="comment">
                                    <span class="comment-name"
                                          th:text="@{__${answer.user.lastName}__ __${answer.user.firstName}__}"></span>
                                    <span th:if="${user == answer.user}"
                                          class="glyphicon glyphicon-remove comment-functional"
                                          th:onclick="'deleteComment('+ ${answer.id} + ')'"></span>
                                    <span th:if="${user == answer.user}"
                                          class="edit-comment glyphicon glyphicon-pencil comment-functional"></span>
                                    <p class="comment-text" th:text="${answer.getContent()}"></p>
                                    <div class="form-edit">
                                        <div class="form-group">
                                            <textarea class="form-control edit-textarea textcomplete"
                                                      th:id="'edit-comment' + ${answer.id}"
                                                      placeholder="Редактор"></textarea>
                                            <button class="btn btn-md btn-success comment-button"
                                                    th:onclick="'editComment(' + ${answer.id} + ')'">Отредактировать
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    </div>
    </div>
</th:block>

<th:block th:fragment="sendTemplateModal">
    <div class="modal fade" th:each="template : ${emailTmpl}" th:if="${!template.hasBody()}" th:id="'sendTemplateModal'+ ${client.id} + ${template.id}" tabindex="-1" role="dialog"  aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Подтвердите свое действие</h5>
                </div>
                <div class="modal-body">
                    <h6>Отправить сообщение пользователю?</h6>
                    <div class="form-сheck">
                        <form class="box-modal">
                            <label class="checkbox-inline" th:if="${client.email} != null">
                                <input type="checkbox" th:text="E-mail"  th:value="email"  class="my-checkbox"/>
                            </label>
                            <th:block th:each="socNetwork : ${client.socialNetworks}">
                                <label class="checkbox-inline">
                                    <input type="checkbox"   th:text="${socNetwork.socialNetworkType.name}"  th:value="${socNetwork.socialNetworkType.name}" class="my-checkbox"/>
                                </label>
                            </th:block>
                            <label class="checkbox-inline" th:if="${client.phoneNumber} != null">
                                <input type="checkbox"  th:text="SMS" th:value="sms" class="my-checkbox"/>
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox"  class="select_all my-checkbox"/>Выбрать все
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox"  class="deselect_all"/>Отменить все
                            </label>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <span th:id = "'sendTemplateStatus-' + ${template.id}+ '-' + ${client.id}"></span>
                    <button type="button" th:id ="'sendTemplateBtn-' + ${template.id} + '-' + ${client.id}" class="btn btn-primary send-all-message"  th:attr="data-client-id=${client.id}, data-template-id=${template.id}">Да</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="downloadModal">

    <!-- Modal -->
    <div class="modal fade" id="downloadModal" tabindex="-1" role="dialog" aria-labelledby="downloadModal"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ModalLabel">Скачать данные</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <select class="form-control" id="selectType" name="selectType">
                        <th:block th:each="socialNetworkType : ${socialNetworkTypes}">
                        <option th:value="${socialNetworkType.name}" th:text="${socialNetworkType.name}"></option>
                            </th:block>
                        <option id="email" name="email" th:value="email">Email</option>
                        <option id="phoneNumber" name="phoneNumber" th:value="phoneNumber">Номер телефона</option>
                    </select>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                    <button type="submit" class="btn btn-primary" role="button" id="clientData">Скачать</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="deleteUser">
    <div th:each="usr : ${users}">
        <div class="modal fade" th:id="'deleteUserModal' + ${usr.id}" tabindex="-1" role="dialog"  aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Подтвердите свое действие</h5>
                    </div>
                    <div class="modal-body">
                        <h6>Вы уверены, что хотите деактивировать пользователя?</h6>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" th:onclick="'deleteUser('+ ${usr.id} + ')'">Да</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
</th:block>

<th:block th:fragment="addSocialNetworkType">
    <div id="addSocialType" class="modal fade" role="dialog">

        <div class="modal-dialog">
            <form role="form" id="addTypeForm" th:action="@{/admin/user/addSocialNetworkType}" method="post">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            &times;
                        </button>
                        <h4> Add SocialNetwork Type </h4>
                    </div>
                    <div class="modal-body container-fluid row">
                        <div class="col-md-4 col-md-offset-4">

                            <div class="form-group text-center">
                                <label for="name">Name</label>
                                <input type="text" id="name" name="name" class="form-control"
                                       placeholder="Name"/>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-info">Add
                        </button>
                        <button type="button" class="btn btn-secondary"
                                data-dismiss="modal">
                            Close
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</th:block>

<th:block th:fragment="changeStatusNameModal">
<div class="modal fade" th:id="'renameStatusModal' + ${status.id}" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="renameStatusModalTitle" th:text="${status.name}"></h5>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label th:for="'change-status-name' + ${status.id}">Новое название статуса</label>
                    <input type="text" class="form-control" th:id="'change-status-name' + ${status.id}" placeholder="Название статуса"/>
                </div>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                <button type="button" class="btn btn-primary" th:onclick="'changeStatusName(\''+ ${status.id} +'\')'">Сохранить</button>
            </div>
        </div>
    </div>
</div>
</th:block>

<th:block th:fragment="deleteStatusModal">
<div class="modal fade" th:id="'deleteStatusModal' + ${status.id}" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Подтвердите свое действие</h5>
            </div>
            <div class="modal-body">
                <h6>Вы уверены, что хотите удалить статус и содержащих его клиентов?</h6>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" th:onclick="'deleteStatus(\''+ ${status.id} +'\')'">Да</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
            </div>
        </div>
    </div>
</div>
</th:block>

<th:block th:fragment="createDefaultStatusModal">
<div class="modal fade" th:if="${statuses.size()== 0}" th:id="createDefaultStatus" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Создание нового статуса</h5>
            </div>
            <div class="modal-body">
                <h6>Стутус по умолчанию не задан. Введите имя нового статуса</h6>
                <div class="form-group">
                    <input id="default-status-name" type="text" class="form-control"
                           placeholder="Введите название статуса"/>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="createNewStatus()">Создать</button>
            </div>
        </div>
    </div>
</div>
</th:block>

<th:block th:fragment="customMessageTemplateModal">
    <div class="modal fade" th:each="template : ${emailTmpl}" th:if="${template.hasBody()}"  th:id="'customMessageTemplate'+ ${client.id} + ${template.id}" tabindex="-1" role="dialog"  aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                        <div class="form-group">
                            <textarea th:id="'custom-eTemplate-body' + ${client.id} + ${template.id}" class="form-control"
                                   placeholder="Основной текст"></textarea>
                        </div>
                    <div class="form-сheck">
                        <form class="box-modal">
                            <label class="checkbox-inline" th:if="${client.email} != null">
                                <input type="checkbox" th:text="E-mail"  th:value="email"  class="my-checkbox"/>
                            </label>
                            <th:block th:each="socNetwork : ${client.socialNetworks}">
                                <label class="checkbox-inline">
                                    <input type="checkbox"   th:text="${socNetwork.socialNetworkType.name}"  th:value="${socNetwork.socialNetworkType.name}" class="my-checkbox"/>
                                </label>
                            </th:block>
                            <label class="checkbox-inline" th:if="${client.phoneNumber} != null">
                                <input type="checkbox"  th:text="SMS" th:value="sms" class="my-checkbox"/>
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox"  class="select_all my-checkbox"/>Выбрать все
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox"  class="deselect_all"/>Отменить все
                            </label>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <span th:id = "'sendCustomEmailTemplateStatus' + ${client.id} + ${template.id}"></span>
                    <button type="button" class="btn btn-primary send-all-custom-message" th:id = "'sendCustomTemplateBtn' + ${client.id} + ${template.id}"  th:attr="data-client-id=${client.id}, data-template-id=${template.id}">Отправить</button>
                </div>
            </div>
        </div>
    </div>
</th:block>
<th:block th:fragment="editMessageTemplateModal">
    <div class="modal fade" th:each="template : ${emailTmpl}" th:id="'editMessageTemplate'+ ${template.id}" tabindex="-1" role="dialog"  aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <h6>Отправить сообщение пользователю?</h6>
                </div>
                <div class="modal-footer">
                    <span th:id = "'editMessageTemplate' + ${template.id}"></span>
                    <button type="button" th:id = "'saveETemplateChangesBtn' + ${template.id}" class="btn btn-primary" th:onclick="'saveETemplateChanges(\'' +  ${template.id} + '\')'">Сохранить</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="updateSocialNetworkType">
    <div th:attr="id=${socialNetworkType.id}" class="modal fade" role="dialog">

        <div class="modal-dialog">
            <form role="form" id="updateTypeForm" th:action="@{/admin/user/updateSocialNetworkType}" method="post">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            &times;
                        </button>
                        <h4> Update SocialNetwork Type </h4>
                    </div>
                    <div class="modal-body container-fluid row">
                        <div class="col-md-4 col-md-offset-4">

                            <div class="form-group text-center">
                                <label for="updateType">Name</label>
                                <input type="text" id="updateType" name="name"
                                       class="form-control"
                                       th:value="${socialNetworkType.name}"/>

                                <input type="hidden" id="typeId" name="id" th:value="${socialNetworkType.id}"/>

                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-info">Update
                        </button>
                        <button type="button" class="btn btn-secondary"
                                data-dismiss="modal">
                            Close
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</th:block>

<th:block th:fragment="hideClient">
    <div class="modal fade" th:id="'hideClient' + ${client.id}" tabindex="-1" role="dialog"  aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Скрыть клиента</h5>
                </div>
                <div class="modal-body">
                    <h6>Вы уверены, что хотите удалить статус и содержащих его клиентов?</h6>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" th:onclick="'hideClient(\''+ ${client.id} +'\')'">OK</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="clientHistory">
    <!-- TODO добавить сюда -->
</th:block>
</body>
</html>

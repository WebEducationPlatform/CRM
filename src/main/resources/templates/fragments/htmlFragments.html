<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
</head>
<body>
<th:block th:fragment="left-panel">
    <div class="col-md-1 sidebar">
        <ul class="nav nav-sidebar">
            <li class="active"><a href="/client">Таблица клиентов</a></li>
            <li><a href="/client/allClients">Таблица всех клиентов</a></li>

        </ul>
    </div>
</th:block>

<th:block th:fragment="top-navigation-panel">
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="navbar-header">
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <span id="logo-span" class="navbar-brand navbar-left">JM-CRM</span>
                    <p class="navbar-text navbar-left">Signed in as <span sec:authentication="name"></span></p>
                </ul>
            </div>

        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="/client">Клиенты</a></li>
                <li><a href="/client/allClients">Все клиенты</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/logout">Выход</a></li>
            </ul>
        </div>

    </nav>
</th:block>

<th:block th:fragment="header">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
          crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
          crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"/>
    <script th:src="@{/js/jquery-3.2.0.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}" type="text/javascript"></script>

    <script type="text/javascript" th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
</th:block>

<th:block th:fragment="comments">
    <div class="modal-footer modal-comments">
        <div class="comments">
            <span><h4>Комментарии:</h4></span>
            <div class="form-group">
                <textarea class="form-control textcomplete" th:id="'new-text-for-client' + ${client.id}"
                                                  placeholder="Напишите комментарий"></textarea>
                <button class="btn btn-md btn-success comment-button"
                        th:onclick="'sendComment(' + ${client.id} + ', \'test_message\')'">Cохранить</button>
            </div>
            <ul class="list-group" th:id="'client-'+${client.id}+'comments'">
                <li class="list-group-item comment-item" th:each="comment : ${client.comments}" th:if="${comment.mainComment == null}">
                    <div th:id="'comment' + ${comment.id}" th:class="comment">
                        <span class="comment-name" th:text="@{__${comment.user.lastName}__ __${comment.user.firstName}__}"></span>
                        <span th:if="${user == comment.user}" class="glyphicon glyphicon-remove comment-functional"
                              th:onclick="'deleteComment('+ ${comment.id} + ')'"></span>
                        <span th:if="${user == comment.user}"
                              class="edit-comment glyphicon glyphicon-pencil comment-functional"></span>
                        <span class="hide-show glyphicon glyphicon-comment comment-functional"></span>
                        <p class="comment-text" th:text="${comment.getContent()}"></p>
                        <div class="form-answer">
                            <div class="form-group">
                                <textarea class="form-control textcomplete" th:id="'new-answer-for-comment' + ${comment.id}"
                                          placeholder="Напишите ответ"></textarea>
                                <button class="btn btn-md btn-success comment-button"
                                        th:onclick="'sendAnswer(' + ${comment.id} + ', \'test_message\')'">Cохранить</button>
                            </div>
                        </div>
                        <div class="form-edit">
                            <div class="form-group">
                                <textarea class="form-control edit-textarea textcomplete" th:id="'edit-comment' + ${comment.id}"
                                          placeholder="Редактор"></textarea>
                                <button class="btn btn-md btn-success comment-button"
                                        th:onclick="'editComment(' + ${comment.id} + ')'">Отредактировать</button>
                            </div>
                        </div>
                        <ul class="answer-list comment-item"
                            th:id="'comment-'+${comment.id}+'answers'">
                            <li th:each="answer : ${comment.answers}">
                                <div th:id="'comment' + ${answer.id}" th:class="comment">
                                    <span class="comment-name"
                                          th:text="@{__${answer.user.lastName}__ __${answer.user.firstName}__}"></span>
                                    <span th:if="${user == answer.user}"
                                          class="glyphicon glyphicon-remove comment-functional"
                                          th:onclick="'deleteComment('+ ${answer.id} + ')'"></span>
                                    <span th:if="${user == answer.user}"
                                          class="edit-comment glyphicon glyphicon-pencil comment-functional"></span>
                                    <p class="comment-text" th:text="${answer.getContent()}"></p>
                                    <div class="form-edit">
                                        <div class="form-group">
                                            <textarea class="form-control edit-textarea textcomplete" th:id="'edit-comment' + ${answer.id}"
                                                      placeholder="Редактор"></textarea>
                                            <button class="btn btn-md btn-success comment-button"
                                                    th:onclick="'editComment(' + ${answer.id} + ')'">Отредактировать</button>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</th:block>

<th:block th:fragment="sendTemplateModal">
    <div class="modal fade" th:each="template : ${emailTmpl}" th:id="'sendTemplateModal'+ ${client.id} + ${template.id}" tabindex="-1" role="dialog"  aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Подтвердите свое действие</h5>
                </div>
                <div class="modal-body">
                    <h6>Отправить сообщение пользователю?</h6>
                </div>
                <div class="modal-footer">
                    <span th:id = "'sendTemplateStatus' + ${template.name}"></span>
                    <button type="button" th:id = "'sendTemplateBtn' + ${template.name}" class="btn btn-primary" th:onclick="'sendTempate(' + ${client.id} + ',\'' +  ${template.name} + '\')'">Да</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                </div>
            </div>
        </div>
    </div>
</th:block>
<th:block th:fragment="deleteUser">
    <div th:each="usr : ${users}">
        <div class="modal fade" th:id="'deleteUserModal' + ${usr.id}" tabindex="-1" role="dialog"  aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Подтвердите свое действие</h5>
                    </div>
                    <div class="modal-body">
                        <h6>Вы уверены, что хотите удалить пользователя?</h6>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" th:onclick="'deleteUser('+ ${usr.id} + ')'">Да</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<th:block th:fragment="changeStatusNameModal">
<div class="modal fade" th:id="'renameStatusModal' + ${status.id}" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="renameStatusModalTitle" th:text="${status.name}"></h5>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label th:for="'change-status-name' + ${status.id}">Новое название статуса</label>
                    <input type="text" class="form-control" th:id="'change-status-name' + ${status.id}" placeholder="Название статуса"/>
                </div>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                <button type="button" class="btn btn-primary" th:onclick="'changeStatusName(\''+ ${status.id} +'\')'">Сохранить</button>
            </div>
        </div>
    </div>
</div>
</th:block>
<th:block th:fragment="deleteStatusModal">
<div class="modal fade" th:id="'deleteStatusModal' + ${status.id}" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Подтвердите свое действие</h5>
            </div>
            <div class="modal-body">
                <h6>Вы уверены, что хотите удалить статус и содержащих его клиентов?</h6>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" th:onclick="'deleteStatus(\''+ ${status.id} +'\')'">Да</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
            </div>
        </div>
    </div>
</div>
</th:block>
<th:block th:fragment="createDefaultStatusModal">
<div class="modal fade" th:if="${statuses.size()== 0}" th:id="createDefaultStatus" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Создание нового статуса</h5>
            </div>
            <div class="modal-body">
                <h6>Стутус по умолчанию не задан. Введите имя нового статуса</h6>
                <div class="form-group">
                    <input id="default-status-name" type="text" class="form-control"
                           placeholder="Введите название статуса"/>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="createNewStatus()">Создать</button>
            </div>
        </div>
    </div>
</div>
</th:block>
<th:block th:fragment="customEmailTemplateModal">
    <div class="modal fade" th:id="customEmailTemplate" tabindex="-1" role="dialog"  aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                        <div class="form-group">
                            <textarea id="custom-eTemplate-body" class="form-control"
                                   placeholder="Основной текст"></textarea>
                        </div>
                </div>
                <div class="modal-footer">
                    <span id = "sendCustomEmailTemplateStatus"></span>
                    <button type="button" class="btn btn-primary" id = 'sendCustomTemplateBtn' th:onclick="'sendCustomTempate(\'' + ${client.id} + '\')'">Отправить</button>
                </div>
            </div>
        </div>
    </div>
</th:block>
<th:block th:fragment="editEmailTemplateModal">
    <div class="modal fade" th:each="template : ${emailTmpl}" th:id="'editEmailTemplate'+ ${template.id}" tabindex="-1" role="dialog"  aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <h6>Отправить сообщение пользователю?</h6>
                </div>
                <div class="modal-footer">
                    <span th:id = "'editEmailTemplate' + ${template.id}"></span>
                    <button type="button" th:id = "'saveETemplateChangesBtn' + ${template.id}" class="btn btn-primary" th:onclick="'saveETemplateChanges(\'' +  ${template.id} + '\')'">Сохранить</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Нет</button>
                </div>
            </div>
        </div>
    </div>
</th:block>
</body>
</html>